<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù‚Ø³Ø§Ø· - Ø¢Ø±ÛŒÙˆ Ù…Ù‚ØªØ¯Ø±</title>
  <style>
    /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø¹ÛŒÙ† Ù†Ø³Ø®Ù‡â€ŒÛŒ ØªÙˆ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Vazir", Tahoma, sans-serif;
    }
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      min-height: 100vh;
      padding: 20px;
      direction: rtl;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
    }
    header {
      text-align: center;
      margin-bottom: 30px;
      color: white;
      text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    .creator {
      font-size: 1rem;
      opacity: 0.9;
      margin-top: 10px;
    }
    .main-card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      margin-bottom: 20px;
    }
    .add-installment-form {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr auto;
      gap: 12px;
      margin-bottom: 30px;
      padding: 25px;
      background: #f8f9fa;
      border-radius: 15px;
    }
    @media (max-width: 768px) {
      .add-installment-form {
        grid-template-columns: 1fr;
      }
    }
    .form-input {
      padding: 12px 15px;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      font-size: 14px;
      transition: all 0.3s;
    }
    .form-input:focus {
      outline: none;
      border-color: #4c6ef5;
      box-shadow: 0 0 0 3px rgba(76, 110, 245, 0.1);
    }
    .add-btn {
      background: #40c057;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 12px 20px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
      transition: all 0.3s;
      white-space: nowrap;
    }
    .add-btn:hover {
      background: #2f9e44;
      transform: translateY(-2px);
    }
    .notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #40c057;
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: none;
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>ğŸ’³ Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ù‚Ø³Ø§Ø·</h1>
      <p class="creator">Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª ÙˆØ§Ù…â€ŒÙ‡Ø§ - Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· Ø¢Ø±ÛŒÙˆ Ù…Ù‚ØªØ¯Ø±</p>
    </header>

    <div class="main-card">
      <h3>â• Ø§ÙØ²ÙˆØ¯Ù† ÙˆØ§Ù… Ø¬Ø¯ÛŒØ¯</h3>
      <div class="add-installment-form">
        <input type="text" id="installmentName" class="form-input" placeholder="Ù†Ø§Ù… ÙˆØ§Ù…" />
        <input type="text" id="installmentMonthly" class="form-input" placeholder="Ù‚Ø³Ø· Ù…Ø§Ù‡ÛŒØ§Ù†Ù‡" />
        <input type="number" id="installmentDay" class="form-input" placeholder="Ø±ÙˆØ² Ø³Ø±Ø±Ø³ÛŒØ¯" />
        <input type="number" id="installmentMonths" class="form-input" placeholder="Ù…Ø§Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù†Ø¯Ù‡" />
        <button class="add-btn" onclick="addInstallment()">â• Ø§ÙØ²ÙˆØ¯Ù†</button>
      </div>

      <div id="installmentsContainer"></div>
    </div>
  </div>

  <div class="notification" id="notification"></div>

  <script>
    let loans = JSON.parse(localStorage.getItem("loans")) || [];

    const persianMonths = [
      "ÙØ±ÙˆØ±Ø¯ÛŒÙ†", "Ø§Ø±Ø¯ÛŒØ¨Ù‡Ø´Øª", "Ø®Ø±Ø¯Ø§Ø¯", "ØªÛŒØ±", "Ù…Ø±Ø¯Ø§Ø¯", "Ø´Ù‡Ø±ÛŒÙˆØ±",
      "Ù…Ù‡Ø±", "Ø¢Ø¨Ø§Ù†", "Ø¢Ø°Ø±", "Ø¯ÛŒ", "Ø¨Ù‡Ù…Ù†", "Ø§Ø³ÙÙ†Ø¯"
    ];

    function gregorianToJalali(gy, gm, gd) {
      let g_d_m = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334];
      let jy = gy - 621;
      let gy2 = gm > 2 ? gy + 1 : gy;
      let days = 365 * gy + parseInt((gy2 + 3) / 4) - parseInt((gy2 + 99) / 100) + parseInt((gy2 + 399) / 400) - 80 + gd + g_d_m[gm - 1];
      jy += 33 * parseInt(days / 12053);
      days %= 12053;
      jy += 4 * parseInt(days / 1461);
      days %= 1461;
      jy += parseInt((days - 1) / 365);
      let jm = days < 186 ? 1 + parseInt(days / 31) : 7 + parseInt((days - 186) / 30);
      let jd = 1 + (days < 186 ? days % 31 : (days - 186) % 30);
      return [jy, jm, jd];
    }

    function getTodayPersianDate() {
      const today = new Date();
      const [jy, jm, jd] = gregorianToJalali(today.getFullYear(), today.getMonth() + 1, today.getDate());
      return { year: jy, month: jm, day: jd, dateStr: `${jy}/${jm}/${jd}` };
    }

    function formatNumber(num) {
      return new Intl.NumberFormat("fa-IR").format(num);
    }

    function showNotification(msg, type = "success") {
      const el = document.getElementById("notification");
      el.textContent = msg;
      el.style.background = type === "success" ? "#40c057" : "#fa5252";
      el.style.display = "block";
      setTimeout(() => (el.style.display = "none"), 3000);
    }

    function saveLoans() {
      localStorage.setItem("loans", JSON.stringify(loans));
    }

    function addInstallment() {
      const name = document.getElementById("installmentName").value.trim();
      const monthly = parseInt(document.getElementById("installmentMonthly").value);
      const day = parseInt(document.getElementById("installmentDay").value);
      const months = parseInt(document.getElementById("installmentMonths").value);

      if (!name || !monthly || !day || !months) return showNotification("Ù‡Ù…Ù‡ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª", "error");

      loans.push({ id: Date.now(), name, monthly, day, months });
      saveLoans();
      renderLoans();
      showNotification("ÙˆØ§Ù… Ø§ÙØ²ÙˆØ¯Ù‡ Ø´Ø¯");
    }

    function renderLoans() {
      const c = document.getElementById("installmentsContainer");
      c.innerHTML = loans.length
        ? loans.map(l => `<div class="loan-card"><b>${l.name}</b> - ${formatNumber(l.monthly)} ØªÙˆÙ…Ø§Ù† (${l.months} Ù…Ø§Ù‡)</div>`).join("")
        : "<p>Ù‡ÛŒÚ† ÙˆØ§Ù…ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</p>";
    }

    // ğŸ•’ ÛŒØ§Ø¯Ø¢ÙˆØ± Ø§Ù‚Ø³Ø§Ø·
    function getPersianDateDiff(d1, d2) {
      return d2.year * 365 + d2.month * 30 + d2.day - (d1.year * 365 + d1.month * 30 + d1.day);
    }

    function sendBrowserNotification(title, body) {
      if (Notification.permission === "granted") new Notification(title, { body });
      else if (Notification.permission !== "denied") Notification.requestPermission();
    }

    function checkReminders() {
      const today = getTodayPersianDate();
      loans.forEach(l => {
        const due = { year: today.year, month: today.month, day: l.day };
        if (getPersianDateDiff(today, due) === 1)
          sendBrowserNotification(`ÙØ±Ø¯Ø§ Ù…ÙˆØ¹Ø¯ Ù‚Ø³Ø· "${l.name}" Ø§Ø³Øª ğŸ’°`, `${formatNumber(l.monthly)} ØªÙˆÙ…Ø§Ù†`);
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      renderLoans();
      checkReminders();
      setInterval(checkReminders, 12 * 60 * 60 * 1000);
    });
  </script>
</body>
</html>
